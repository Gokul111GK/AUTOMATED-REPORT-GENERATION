import pandas as pd
import matplotlib.pyplot as plt
from fpdf import FPDF
from datetime import datetime

# Step 1: Load CSV
df = pd.read_csv("sample_data.csv")

# Step 2: Analyze Data
total_employees = df["Employees"].sum()
total_budget = df["Budget"].sum()

# Step 3: Plot chart
plt.bar(df["Department"], df["Budget"], color="skyblue")
plt.title("Budget Allocation")
plt.ylabel("Budget")
plt.tight_layout()
plt.savefig("budget_chart.png")
plt.close()

# Step 4: Create PDF
pdf = FPDF()
pdf.add_page()

pdf.set_font("Arial", "B", 16)
pdf.cell(200, 10, "Department Report", ln=1, align="C")
pdf.set_font("Arial", "", 12)
pdf.cell(200, 10, f"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}", ln=1, align="C")
pdf.ln(10)

pdf.set_font("Arial", "", 12)
pdf.cell(0, 10, f"Total Employees: {total_employees}", ln=1)
pdf.cell(0, 10, f"Total Budget: INR {total_budget:,}", ln=1)

pdf.ln(10)
pdf.set_font("Arial", "B", 12)
pdf.cell(0, 10, "Department Breakdown", ln=1)
pdf.set_font("Arial", "", 12)
for _, row in df.iterrows():
    pdf.cell(0, 10, f"{row['Department']}: {row['Employees']} employees, INR {row['Budget']:,}", ln=1)

pdf.ln(10)
pdf.image("budget_chart.png", x=30, w=150)

pdf.output("generated_report.pdf")
